<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Emscripten-Generated Code</title>
    <style>
    </style>
  </head>
  <body>
    <h1>Convert file input to Blob</h1>
    <div>
      <label for="load-file">Load a file:</label>
      <input type="file" id="load">
    </div>
    <script async src=build/gpmf-parser.js></script>
    <script type='text/javascript'>
    </script>
    <button class="mybutton">Run myFunction</button>
    <script>
    document.querySelector('.mybutton')
    .addEventListener('click', function() {

        const files = document.getElementById('load').files;

        const f = document.getElementById('load').files[0];
        var reader = new FileReader();
        reader.onload = function(e){
          var raw = e.target.result;
          // https://developer.mozilla.org/en/JavaScript_typed_arrays
          var bytes = new Uint8Array(raw);
          //var hex = "";
          //for (var cycle = 0 ; cycle < raw.byteLength ; cycle++) {
          //  hex += bytes[cycle].toString(16) + " ";
          //  if (!((cycle + 1) % 8))
          //      hex += "\n";
          //}

          const n_bytes = bytes.length*bytes.BYTES_PER_ELEMENT;
          console.log(n_bytes);
          var buf = Module._malloc(n_bytes);
          Module.HEAPU8.set(bytes, buf);
          var result = _myFunction(buf, n_bytes);
          Module._free(buf);
        }
        reader.readAsArrayBuffer(f);
    });
    </script>
  </body>
</html>
